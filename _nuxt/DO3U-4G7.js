import{aD as oe,u as se,x as ie,bA as de,ar as I,bn as N,r as re,c as p,g as c,f as l,C as a,w as i,ah as A,a8 as ue,aE as ce,ai as me,d as r,z,e as Y,ba as pe,a5 as fe,bC as ge,F as _,a2 as V,t as b,bD as f,bF as B,bU as F}from"./C5HeKxGp.js";import{_ as _e,a as be}from"./Dmmm4gHV.js";import{l as ve,_ as ye}from"./CsScxHpS.js";import{_ as De}from"./5AG7xWct.js";import{u as h,f as $e}from"./BldGL65R.js";import"./CF2HthMV.js";import"./BBShya35.js";import"./B01-JqJ1.js";import"./XtscgSls.js";const ke={class:"flex gap-4"},Ce={class:"space-x-2"},Ie={class:"flex gap-2"},Ve={class:"flex gap-2"},he={class:"text-center text-xl"},Ye={__name:"learning-plan",async setup(xe){let d,u;const x=oe(),{$api:g}=se(),U=ie(),v=new de("zh-CN",{dateStyle:"medium"}),{data:K,refresh:y,pending:S}=([d,u]=I(()=>h("/LearingPlan/listPlans")),d=await d,u(),d),{data:T,loading:O,refresh:E}=([d,u]=I(()=>h("/Account/listAllUser",{key:"students",transform:o=>o?.list?.filter(e=>e.role===U.appInfo.roleEnum.student)?.map(e=>({label:e.userName,value:e.id})),lazy:!0})),d=await d,u(),d),{data:G,loading:j,refresh:q}=([d,u]=I(()=>h("/LearningMaterials/ListVocabularyMaterials",{key:"learning-materials",transform:o=>o.map(e=>({label:e.content,value:e.id})),lazy:!0})),d=await d,u(),d),H=[{accessorKey:"id",header:"ID"},{accessorKey:"title",header:"标题"},{accessorKey:"description",header:"描述"},{accessorKey:"student.userName",header:"学生"},{accessorKey:"isDeleted",header:"已删除",cell:({row:o})=>$e(U.appInfo.booleanOptions,o.getValue("isDeleted"))},{accessorKey:"createdAt",header:"创建时间",cell:({row:o})=>new Date(o.getValue("createdAt")).toLocaleString("zh-CN",{year:"numeric",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},{accessorKey:"actions",header:"操作"}],[D,$]=N(),[k,C]=N(),t=re({id:void 0,title:"",description:"",studentId:null,materialIds:{},startDate:null,endDate:null,dateRange:{start:null,end:null}}),M=async o=>{if(o&&o.id){const e=await g(`LearingPlan/GetPlanById/${o.id}`);t.value={...o,materialIds:e.items.map(s=>s.materialId),dateRange:{start:F(e.startDate),end:F(e.endDate)}}}else t.value={id:void 0,title:"",description:"",studentId:null,materialIds:{},startDate:null,endDate:null,dateRange:{start:null,end:null}};$(!0)},J=o=>{t.value={...o},C(!0)},Q=()=>{C(!1)},W=async()=>{const o=await g(`/LearingPlan/DeletePlan/${t.value.id}`,{method:"delete"});x.add({title:o||"删除成功",color:"success"}),C(!1),await y()},R=async()=>{const o={id:void 0,title:t.value.title,description:t.value.description,startDate:t.value.dateRange.start?B(t.value.dateRange.start.toDate(f()),"YYYY-MM-DD").value:null,endDate:t.value.dateRange.end?B(t.value.dateRange.end.toDate(f()),"YYYY-MM-DD").value:null,studentId:t.value.studentId,materialIds:t.value.materialIds};t.value.id?(o.id=t.value.id,await g("/LearingPlan/UpdatePlan",{method:"put",body:o})):await g("/LearingPlan/CreatePlan",{method:"post",body:o}),x.add({title:"保存成功",color:"success"}),await y(),$(!1)},X=()=>{$(!1)};function Z(){ce("/teacher?tab=student")}return(o,e)=>{const s=ue,ee=_e,P=fe,m=pe,ae=be,te=ge,L=ye,le=De,w=me;return r(),p("div",null,[c("div",ke,[l(s,{label:"刷新",color:"secondary",onClick:e[0]||(e[0]=n=>a(y)())}),l(s,{label:"添加",onClick:e[1]||(e[1]=n=>M())}),l(s,{label:"返回",variant:"subtle",onClick:e[2]||(e[2]=n=>Z())})]),e[12]||(e[12]=c("h3",{class:"text-base font-semibold leading-6 my-4"}," 学习计划列表 ",-1)),l(ee,{data:a(K),columns:H,loading:a(S)},{"actions-cell":i(({row:n})=>[c("div",Ce,[n.original.isDeleted?Y("",!0):(r(),z(s,{key:0,icon:"i-lucide-edit",variant:"outline",color:"info",size:"sm",title:"编辑",onClick:ne=>M(n.original)},null,8,["onClick"])),n.original.isDeleted?Y("",!0):(r(),z(s,{key:1,icon:"i-lucide-trash",variant:"outline",color:"error",size:"sm",title:"删除",onClick:ne=>J(n.original)},null,8,["onClick"]))])]),_:1},8,["data","loading"]),l(w,{open:a(D),"onUpdate:open":e[9]||(e[9]=n=>A(D)?D.value=n:null),title:`${a(t).id?"编辑":"添加"} `},{body:i(()=>[l(le,{schema:a(ve),class:"space-y-4",onSubmit:e[8]||(e[8]=n=>R())},{default:i(()=>[l(m,{label:"学习计划标题",name:"title"},{default:i(()=>[l(P,{modelValue:a(t).title,"onUpdate:modelValue":e[3]||(e[3]=n=>a(t).title=n),placeholder:"输入学习计划标题"},null,8,["modelValue"])]),_:1}),l(m,{label:"描述",name:"description"},{default:i(()=>[l(P,{modelValue:a(t).description,"onUpdate:modelValue":e[4]||(e[4]=n=>a(t).description=n),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),l(m,{label:"开始/结束日期",name:"dateRange"},{default:i(()=>[l(te,null,{content:i(()=>[l(ae,{modelValue:a(t).dateRange,"onUpdate:modelValue":e[5]||(e[5]=n=>a(t).dateRange=n),class:"p-2","number-of-months":2,range:"",locale:"zh-CN"},null,8,["modelValue"])]),default:i(()=>[l(s,{color:"neutral",variant:"subtle",icon:"i-lucide-calendar"},{default:i(()=>[a(t).dateRange.start?(r(),p(_,{key:0},[a(t).dateRange.end?(r(),p(_,{key:0},[V(b(a(v).format(a(t).dateRange.start.toDate(a(f)())))+" - "+b(a(v).format(a(t).dateRange.end.toDate(a(f)()))),1)],64)):(r(),p(_,{key:1},[V(b(a(v).format(a(t).dateRange.start.toDate(a(f)()))),1)],64))],64)):(r(),p(_,{key:1},[V(" 请选择开始/结束日期 ")],64))]),_:1})]),_:1})]),_:1}),l(m,{label:"学生",name:"studentId"},{default:i(()=>[c("div",Ie,[l(L,{modelValue:a(t).studentId,"onUpdate:modelValue":e[6]||(e[6]=n=>a(t).studentId=n),items:a(T),loading:a(O),placeholder:"请选择学生"},null,8,["modelValue","items","loading"]),l(s,{icon:"i-lucide-refresh-ccw",color:"info",onClick:a(E)},null,8,["onClick"])])]),_:1}),l(m,{label:"学习资料",name:"materialIds"},{default:i(()=>[c("div",Ve,[l(L,{modelValue:a(t).materialIds,"onUpdate:modelValue":e[7]||(e[7]=n=>a(t).materialIds=n),items:a(G),loading:a(j),multiple:"",placeholder:"请选择学习资料"},null,8,["modelValue","items","loading"]),l(s,{icon:"i-lucide-refresh-ccw",color:"info",onClick:a(q)},null,8,["onClick"])])]),_:1})]),_:1},8,["schema"])]),footer:i(()=>[l(s,{label:"取消",variant:"subtle",onClick:X}),l(s,{label:"保存",color:"success",onClick:R})]),_:1},8,["open","title"]),l(w,{open:a(k),"onUpdate:open":e[11]||(e[11]=n=>A(k)?k.value=n:null),title:"提醒"},{body:i(()=>[c("div",he," 确定删除： "+b(a(t).title)+" 吗？ ",1)]),footer:i(()=>[l(s,{label:"取消",variant:"subtle",onClick:Q}),l(s,{label:"确定",color:"success",type:"submit",onClick:e[10]||(e[10]=n=>W())})]),_:1},8,["open"])])}}};export{Ye as default};
